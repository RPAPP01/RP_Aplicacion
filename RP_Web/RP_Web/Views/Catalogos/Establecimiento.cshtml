@model List<RP_Web.Models.EstaModel>
@{
    ViewBag.Title = "Establecimiento";
}

    <div class="card-footer">
        <a style="font-size:35px; font-weight:bold"> Establecimiento </a><button type="submit" class="btn btn-success" onclick="insertmodal()">Agregar </button>
    </div>

<table id="tablestatu" class="table table-bordered table table-hover active">
    <thead>
        <tr style="background-color:#b1f3b7">
            <th style="text-align:left;" class="success">ID Lugar</th>
            <th style="text-align: left;" class="success">ID Clasificacion</th>
            <th style="text-align:left;" class="success">Nombre del Lugar </th>
            <th style="text-align:left;" class="success">Ubicacion </th>
            <th style="text-align:left;" class="success">Telefono </th>
            <th style="text-align:left;" class="success">Correo </th>
            <th style="text-align:left;" class="success">Habilitado </th>
            <th style="text-align:left;" class="success">Editar</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var u in Model)
        {
        <tr>
            <td>@u.LugarReservaId</td>
            <td>@u.ClasificacionId</td>
            <td>@u.NombreLugar</td>
            <td>@u.Ubicacion</td>
            <td>@u.Telefono</td>
            <td>@u.Correo</td>
            <td>@u.Habilitado</td>

            <td style="width:200px; text-align:center">
                <a title="Editar" data-value="@u.LugarReservaId" onclick="actualizar('@u.LugarReservaId', '@u.ClasificacionId', '@u.NombreLugar', '@u.Ubicacion', '@u.Telefono', '@u.Correo', '@u.Habilitado')"><i class="fas fa-edit"></i></a>
                <!--Html.ActionLink("Editar", "Editar", "Municipio", new { municipio = u.municipio}, null)-->
                <!--<a title="Eliminar" onclick="return confirm('¿Esta seguro?');" href="~/estado/index/u.estado"><i class="glyphicon glyphicon-remove"></i></a>-->
            </td>
        </tr>
        }
    </tbody>
</table>

<!--Modal para Insertar datos-->
<div class="modal fade" id="EstaInsert" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Agregar Establecimiento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Lugar:</label>
                        <input type="text" class="form-control" id="LR">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Clasificacion:</label>
                        <input type="text" class="form-control" id="C">
                    </div>
                    <div class="mb-3">
                        <label for="message-name" class="col-form-label">Nombre:</label>
                        @*<input type="text" class="form-control" id="LR">*@
                        <select class="form-control select2" style="width: 100%;" id="NL">
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Ubicacion:</label>
                        <input type="text" class="form-control" id="U">
                    </div>
                    <div class="mb-3">
                        <label for="message-name" class="col-form-label">Telefono:</label>
                        <input type="text" class="form-control" id="T">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Correo:</label>
                        <input type="text" class="form-control" id="CO">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Habilitado:</label>
                        @*<input type="text" class="form-control" id="AH">*@
                        <select class="form-control select2" style="width: 100%;" id="H">
                            <option value="1">SI</option>
                            <option value="0">NO</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="btn_insert()">Send message</button>
            </div>
        </div>
    </div>
</div>

<!--Modal para actualizar datos-->
<div class="modal fade" id="EstaUpdate" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Actualizar Establecimiento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Lugar:</label>
                        <input type="text" class="form-control" id="ALR">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Clasificacion:</label>
                        <input type="text" class="form-control" id="AC">
                    </div>
                    <div class="mb-3">
                        <label for="message-name" class="col-form-label">Nombre:</label>
                        @*<input type="text" class="form-control" id="LR">*@
                        <select class="form-control select2" style="width: 100%;" id="ANL">
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Ubicacion:</label>
                        <input type="text" class="form-control" id="AU">
                    </div>
                    <div class="mb-3">
                        <label for="message-name" class="col-form-label">Telefono:</label>
                        <input type="text" class="form-control" id="AT">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Correo:</label>
                        <input type="text" class="form-control" id="ACO">
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Habilitado:</label>
                        @*<input type="text" class="form-control" id="AH">*@
                        <select class="form-control select2" style="width: 100%;" id="AH">
                            <option value="1">SI</option>
                            <option value="0">NO</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="btn_actualizar()">Send message</button>
            </div>
        </div>
    </div>
</div>

<script>

    $('.select2').select2()
    function actualizar(Lugar, Nombre, Clasificacion, Ubicacion, Telefono, Correo, Habilitado) {

        $('#ALR').val(Lugar);
        $('#AC').val(Nombre);
        $('#ANL').val(Clasificacion);
        $('#AU').val(Ubicacion);
        $('#AT').val(Telefono);
        $('#ACO').val(Correo);
        $('#AH').val(Habilitado);

        $('#EstaUpdate').modal('show');
        select_ClasificacionUp();


    }

    function insertmodal() {

        $('#EstaInsert').modal('show'); //Mostrar modal por medio del ID
        select_ClasificacionIn();
    }

    function btn_insert() {

        var dato = document.getElementById("H").value; //Igualar la opcion a 1 si se elige la opcion *SI*
        if (dato.selectedIndex == "SI") tt.value = 1; 

       

        $.ajax({
            url: '/Catalogos/EstablecimientoInsert', //Ruta del Controlador
            type: "POST",
            data: {
                Query: 'Insert', 
                LugarReservaId: $('#LR').val(), //traer datos de HTML
                ClasificacionId: $('#C').val(),
                NombreLugar: $('#NL').val(),
                Ubicacion: $('#U').val(),
                Telefono: $('#T').val(),
                Correo: $('#CO').val(),
                Habilitado: $('#H').val(),
            },
            success: function (data) {
            }
        });


    }

    function btn_actualizar() {

        var dato = document.getElementById("AH").value; //Igualar la opcion a 1 si se elige la opcion *SI*
        if (dato.selectedIndex == "SI") tt.value = 1; 

        $.ajax({
            url: '/Catalogos/EstablecimientoUpdate', //Ruta del Controlador
            type: "POST",
            data: {
                Query: 'Update', 
                LugarReservaId: $('#ALR').val(), //traer datos de HTML
                ClasificacionId: $('#AC').val(),
                NombreLugar: $('#ANL').val(),
                Ubicacion: $('#AU').val(),
                Telefono: $('#AT').val(),
                Correo: $('#ACO').val(),
                Habilitado: $('#AH').val(),
            },
            success: function (data) {
                 window.location.reload();
            }
        });
    }

    
    function select_ClasificacionIn() {
    $.ajax({
        url: '/Catalogos/Select_Clasificacion',
        type: "POST",
        dataType: "JSON",
        success: function (data) {
           console.log(data);
            $.each(data, function (idx, elm) {
                var zE = document.createElement("option");
                zE.setAttribute("value", elm['ClasificacionId']);
                var tE = document.createTextNode(elm['Descripcion']);
                zE.appendChild(tE);
                document.getElementById("NL").appendChild(zE);
            });
        }
    });
    }

    function select_ClasificacionUp() {
    $.ajax({
        url: '/Catalogos/Select_Clasificacion',
        type: "POST",
        dataType: "JSON",
        success: function (data) {
           console.log(data);
            $.each(data, function (idx, elm) {
                var zE = document.createElement("option");
                zE.setAttribute("value", elm['ClasificacionId']);
                var tE = document.createTextNode(elm['Descripcion']);
                zE.appendChild(tE);
                document.getElementById("ANL").appendChild(zE);
            });
        }
    });
}
</script>